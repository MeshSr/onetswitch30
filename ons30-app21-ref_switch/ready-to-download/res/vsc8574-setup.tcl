################################################################################
### STEP 1: basic op. to enable mdio
################################################################################
# enable all mdio
mw 43c00500 00000050;
mw 43c40500 00000050;
mw 43c80500 00000050;
mw 43cc0500 00000050;

################################################################################
### STEP 2: config. vsc8574 General Purpose registers
################################################################################
# turn to GP reg., global config. via PHY0
mw 43c00508 00000010; mw 43c00504 101f4800;
# set 19G.15:14=00, def. 0x000f
mw 43c00508 0000000f; mw 43c00504 10134800;
# set 18G=0x80f0, def. 0x0000
mw 43c00508 000080f0; mw 43c00504 10124800;
# back to IEEE reg.
mw 43c00508 00000000; mw 43c00504 101f4800;

################################################################################
### STEP 3: config. vsc8574 IEEE 802.3 and main registers
################################################################################
# PHY0-3: set Reg 23.10:8=000, 23.12=0, def. 0x0004
mw 43c00508 00000000; mw 43c00504 10174800;
mw 43c00508 00000000; mw 43c00504 11174800;
mw 43c00508 00000000; mw 43c00504 12174800;
mw 43c00508 00000000; mw 43c00504 13174800;

################################################################################
### STEP 4: software reset to enable above config.
################################################################################
# PHY0-3: set Reg 0.15=1 to reset, check reset done
mw 43c00508 00009140; mw 43c00504 10004800;
mw 43c00508 00009140; mw 43c00504 11004800;
mw 43c00508 00009140; mw 43c00504 12004800;
mw 43c00508 00009140; mw 43c00504 13004800;

################################################################################
### STEP 5: config. vsc8574 Extended Page 3 registers, to enable mac serdes AN
################################################################################
# PHY0: turn to EXT3 reg.
mw 43c00508 00000003; mw 43c00504 101f4800;
# PHY0: set 16E3.7=1 to enable AN, def. 0x0100
mw 43c00508 00000180; mw 43c00504 10104800;
# PHY0: back to IEEE reg.
mw 43c00508 00000000; mw 43c00504 101f4800;

# PHY1: turn to EXT3 reg.
mw 43c00508 00000003; mw 43c00504 111f4800;
# PHY1: set 16E3.7=1 to enable AN, def. 0x0100
mw 43c00508 00000180; mw 43c00504 11104800;
# PHY1: back to IEEE reg.
mw 43c00508 00000000; mw 43c00504 111f4800;

# PHY2: turn to EXT3 reg.
mw 43c00508 00000003; mw 43c00504 121f4800;
# PHY2: set 16E3.7=1 to enable AN, def. 0x0100
mw 43c00508 00000180; mw 43c00504 12104800;
# PHY2: back to IEEE reg.
mw 43c00508 00000000; mw 43c00504 121f4800;

# PHY3: turn to EXT3 reg.
mw 43c00508 00000003; mw 43c00504 131f4800;
# PHY3: set 16E3.7=1 to enable AN, def. 0x0100
mw 43c00508 00000180; mw 43c00504 13104800;
# PHY3: back to IEEE reg.
mw 43c00508 00000000; mw 43c00504 131f4800;

################################################################################
### STEP 6: config. pcs/pma and vsc8574 IEEE Reg 0
################################################################################
# set pcs/pma Reg 0 (ctrl), def. 0x1540 (isolate)
mw 43c00508 00001140; mw 43c00504 05004800;
mw 43c40508 00001140; mw 43c40504 05004800;
mw 43c80508 00001140; mw 43c80504 05004800;
mw 43cc0508 00001140; mw 43cc0504 05004800;

# set vsc8574 Reg 0 (ctrl), def. 0x1040 (half dup.)
mw 43c00508 00001140; mw 43c00504 10004800;
mw 43c00508 00001140; mw 43c00504 11004800;
mw 43c00508 00001140; mw 43c00504 12004800;
mw 43c00508 00001140; mw 43c00504 13004800;

################################################################################
### STEP 7: check config/status reg.
################################################################################
# get pcs/pma Reg 0 (config)
# def. 0x1540, good 0x1140
mw 43c00504 05008800; sleep 1; md 43c00500 4;
mw 43c40504 05008800; sleep 1; md 43c40500 4;
mw 43c80504 05008800; sleep 1; md 43c80500 4;
mw 43cc0504 05008800; sleep 1; md 43cc0500 4;

# get vsc8574 Reg 0 (config)
# def. 0x1040, good 0x1140
mw 43c00504 10008800; sleep 1; md 43c00500 4;
mw 43c00504 11008800; sleep 1; md 43c00500 4;
mw 43c00504 12008800; sleep 1; md 43c00500 4;
mw 43c00504 13008800; sleep 1; md 43c00500 4;

# get pcs/pma Reg 1 (status)
# def. 0x01c8, good 0x01ec, latch 0x01f8|0x01e8
mw 43c00504 05018800; sleep 1; md 43c00500 4;
mw 43c40504 05018800; sleep 1; md 43c40500 4;
mw 43c80504 05018800; sleep 1; md 43c80500 4;
mw 43cc0504 05018800; sleep 1; md 43cc0500 4;

# get vsc8574 Reg 1 (status)
# def. 0x79c9, good 0x79ed
mw 43c00504 10018800; sleep 1; md 43c00500 4;
mw 43c00504 11018800; sleep 1; md 43c00500 4;
mw 43c00504 12018800; sleep 1; md 43c00500 4;
mw 43c00504 13018800; sleep 1; md 43c00500 4;

################################################################################
### STEP 8: check AN reg.
################################################################################
# get pcs/pma Reg 4 (AN ADV)
# always 0x0001
mw 43c00504 05048800; sleep 1; md 43c00500 4;
mw 43c40504 05048800; sleep 1; md 43c40500 4;
mw 43c80504 05048800; sleep 1; md 43c80500 4;
mw 43cc0504 05048800; sleep 1; md 43cc0500 4;

# get vsc8574 Reg 4 (AN ADV)
# def. 0x01e1, good 0x01e1
mw 43c00504 10048800; sleep 1; md 43c00500 4;
mw 43c00504 11048800; sleep 1; md 43c00500 4;
mw 43c00504 12048800; sleep 1; md 43c00500 4;
mw 43c00504 13048800; sleep 1; md 43c00500 4;

# get pcs/pma Reg 5 (AN LP)
# def. 0x0001, good 0x5801(should be 0xd801)
mw 43c00504 05058800; sleep 1; md 43c00500 4;
mw 43c40504 05058800; sleep 1; md 43c40500 4;
mw 43c80504 05058800; sleep 1; md 43c80500 4;
mw 43cc0504 05058800; sleep 1; md 43cc0500 4;

# get vsc8574 Reg 5 (AN LP)
# def. 0x0000, good 0xcde1
mw 43c00504 10058800; sleep 1; md 43c00500 4;
mw 43c00504 11058800; sleep 1; md 43c00500 4;
mw 43c00504 12058800; sleep 1; md 43c00500 4;
mw 43c00504 13058800; sleep 1; md 43c00500 4;